<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯»å®å¤§å†’é™© - åœ°ç‚¹åœºæ™¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a2e;
            color: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* åœºæ™¯å®¹å™¨ */
        .scene-container {
            width: 100vw;
            height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 1s ease-in-out;
            overflow: hidden;
        }
        
        /* æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* åœºæ™¯å†…å®¹åŠ¨ç”» */
        .scene-content {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.8s ease-out;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* åœºæ™¯å†…å®¹ */
        .scene-content {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        /* æ ‡é¢˜ */
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #f1c40f;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }
        
        /* åœºæ™¯æè¿° */
        .scene-description {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        /* æ¸¸æˆçŠ¶æ€ */
        .game-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .status-label {
            font-weight: bold;
            color: #f1c40f;
        }
        
        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.3);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(241, 196, 15, 0.5);
        }
        
        button:active {
            transform: translateY(-2px) scale(0.98);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }
        
        button.secondary:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f618d 100%);
            box-shadow: 0 12px 35px rgba(52, 152, 219, 0.5);
        }
        
        button:disabled {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled:hover::before {
            left: -100%;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            font-size: 16px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        /* æ—¥å¿—åŒºåŸŸ */
        .log-area {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 300px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .log-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #f1c40f;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 14px;
        }
        
        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* åœºæ™¯ç‰¹å®šæ ·å¼ */
        .scene-library {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080"><defs><linearGradient id="libGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%238b4513;stop-opacity:0.8" /><stop offset="100%" style="stop-color:%23a0522d;stop-opacity:0.8" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23libGrad)"/><text x="50%" y="50%" font-size="100" fill="white" font-weight="bold" text-anchor="middle">ğŸ“š å¤è€å›¾ä¹¦é¦†</text></svg>');
        }
        
        .scene-guild {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080"><defs><linearGradient id="guildGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%232ecc71;stop-opacity:0.8" /><stop offset="100%" style="stop-color:%2327ae60;stop-opacity:0.8" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23guildGrad)"/><text x="50%" y="50%" font-size="100" fill="white" font-weight="bold" text-anchor="middle">âš”ï¸ å†’é™©è€…å·¥ä¼š</text></svg>');
        }
        
        .scene-forest {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080"><defs><linearGradient id="forestGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%233498db;stop-opacity:0.8" /><stop offset="100%" style="stop-color:%232980b9;stop-opacity:0.8" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23forestGrad)"/><text x="50%" y="50%" font-size="100" fill="white" font-weight="bold" text-anchor="middle">ğŸŒ² ç¥ç§˜æ£®æ—</text></svg>');
        }
        
        .scene-temple {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080"><defs><linearGradient id="templeGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23e74c3c;stop-opacity:0.8" /><stop offset="100%" style="stop-color:%23c0392b;stop-opacity:0.8" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23templeGrad)"/><text x="50%" y="50%" font-size="100" fill="white" font-weight="bold" text-anchor="middle">â›©ï¸ ç¥åœ£ç¥åº™</text></svg>');
        }
        
        .scene-treasure {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080"><defs><linearGradient id="treasureGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ffd700;stop-opacity:0.8" /><stop offset="100%" style="stop-color:%23f39c12;stop-opacity:0.8" /></linearGradient></defs><rect width="100%" height="100%" fill="url(%23treasureGrad)"/><text x="50%" y="50%" font-size="100" fill="white" font-weight="bold" text-anchor="middle">ğŸ’ å®è—åœ°ç‚¹</text></svg>');
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="locationMusic" loop autoplay>
        <source id="musicSource" src="" type="audio/mpeg">
    </audio>
    
    <div class="scene-container" id="sceneContainer">
        <!-- è¿”å›ä¸»æ¸¸æˆæŒ‰é’® -->
        <button class="back-button" onclick="goToMainGame()" style="top: 70px; left: 20px;">ğŸ® è¿”å›ä¸»æ¸¸æˆ</button>
        
        <!-- è¿”å›å…¨æ™¯å›¾æŒ‰é’® -->
        <button class="back-button" onclick="goBackToPanorama()">ğŸ  è¿”å›å…¨æ™¯å›¾</button>
        
        <!-- éŸ³ä¹æ§åˆ¶ -->
        <div class="music-control" onclick="toggleMusic()">
            <span id="musicIcon">ğŸ”Š</span>
            <span>èƒŒæ™¯éŸ³ä¹</span>
        </div>
        
        <!-- åœºæ™¯å†…å®¹ -->
        <div class="scene-content">
            <h1 id="locationTitle">åœ°ç‚¹åç§°</h1>
            <div class="scene-description" id="locationDescription">åœ°ç‚¹æè¿°</div>
            
            <div class="game-status">
                <div class="status-item">
                    <span class="status-label">é‡‘å¸:</span>
                    <span id="gold">100</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æ‰“æ‰‹:</span>
                    <span id="helpers">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">çº¿ç´¢:</span>
                    <span id="clues">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å½“å‰ä½ç½®:</span>
                    <span id="currentLocation">æœªçŸ¥</span>
                </div>
            </div>
            
            <div class="button-group" id="actionButtons">
                <!-- åŠ¨æ€ç”ŸæˆæŒ‰é’® -->
            </div>
        </div>
        
        <!-- æ—¥å¿—åŒºåŸŸ -->
        <div class="log-area">
            <div class="log-title">ğŸ“ å†’é™©æ—¥å¿—</div>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const GAME_CONFIG = {
            initialGold: 100,
            helperCost: 10,
            helperReward: 8,
            helperCompensation: 5,
            clueReward: 20,
            treasureReward: 500
        };
        
        // åœºæ™¯é¡ºåºé…ç½®
        const SCENE_ORDER = ["library", "guild", "forest", "temple", "treasure"];
        
        // åœ°ç‚¹é…ç½®
        const LOCATIONS = {
            library: {
                name: "å¤è€å›¾ä¹¦é¦†",
                description: "è¿™é‡Œå¼¥æ¼«ç€å¤è€çš„ä¹¦é¦™ï¼Œä¹¦æ¶ä¸Šæ‘†æ»¡äº†ç¥ç§˜çš„å¤ç±ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå¯»æ‰¾çº¿ç´¢ã€‚",
                musicUrl: "https://www.bensound.com/bensound-music/bensound-acousticbreeze.mp3",
                actions: [
                    { id: "search", name: "å¯»æ‰¾çº¿ç´¢", action: "searchClue" },
                    { id: "decode", name: "è§£ç çº¿ç´¢", action: "decodeClue", condition: (data) => data.clues >= 1 },
                    { id: "goToGuild", name: "å‰å¾€å·¥ä¼š", action: "goToLocation", params: { location: "guild" }, condition: (data) => data.unlockedScenes.includes("guild") }
                ]
            },
            guild: {
                name: "å†’é™©è€…å·¥ä¼š",
                description: "è¿™é‡Œèšé›†ç€å„ç§å†’é™©è€…ï¼Œä½ å¯ä»¥é›‡ä½£æ‰“æ‰‹æ¥å¸®åŠ©ä½ ã€‚",
                musicUrl: "https://www.bensound.com/bensound-music/bensound-epic.mp3",
                actions: [
                    { id: "hire", name: "é›‡ä½£æ‰“æ‰‹", action: "hireHelper" },
                    { id: "goToLibrary", name: "è¿”å›å›¾ä¹¦é¦†", action: "goToLocation", params: { location: "library" } },
                    { id: "goToForest", name: "å‰å¾€æ£®æ—", action: "goToLocation", params: { location: "forest" }, condition: (data) => data.unlockedScenes.includes("forest") }
                ]
            },
            forest: {
                name: "ç¥ç§˜æ£®æ—",
                description: "èŒ‚å¯†çš„æ ‘æ—ä¸­å……æ»¡äº†æœªçŸ¥çš„å±é™©ï¼Œä½ éœ€è¦å°å¿ƒç©¿è¶Šã€‚",
                musicUrl: "https://www.bensound.com/bensound-music/bensound-jazzyfrenchy.mp3",
                actions: [
                    { id: "cross", name: "ç©¿è¶Šæ£®æ—", action: "crossForest" },
                    { id: "goToGuild", name: "è¿”å›å·¥ä¼š", action: "goToLocation", params: { location: "guild" } },
                    { id: "goToTemple", name: "å‰å¾€ç¥åº™", action: "goToLocation", params: { location: "temple" }, condition: (data) => data.unlockedScenes.includes("temple") }
                ]
            },
            temple: {
                name: "ç¥åœ£ç¥åº™",
                description: "å¤è€çš„ç¥åº™ä¸­éšè—ç€å®è—çš„ç§˜å¯†ï¼Œä½†ä¹Ÿæœ‰å®ˆå«å·¡é€»ã€‚",
                musicUrl: "https://www.bensound.com/bensound-music/bensound-relaxing.mp3",
                actions: [
                    { id: "searchTemple", name: "æœç´¢ç¥åº™", action: "searchTemple" },
                    { id: "goToForest", name: "è¿”å›æ£®æ—", action: "goToLocation", params: { location: "forest" } },
                    { id: "goToTreasure", name: "å‰å¾€å®è—ç‚¹", action: "goToLocation", params: { location: "treasure" }, condition: (data) => data.unlockedScenes.includes("treasure") }
                ]
            },
            treasure: {
                name: "å®è—åœ°ç‚¹",
                description: "ä¼ è¯´ä¸­çš„å®è—å°±è—åœ¨è¿™é‡Œï¼Œä½ éœ€è¦è¶³å¤Ÿçš„å®åŠ›æ‰èƒ½è·å¾—å®ƒã€‚",
                musicUrl: "https://www.bensound.com/bensound-music/bensound-happyrock.mp3",
                actions: [
                    { id: "openTreasure", name: "æ‰“å¼€å®ç®±", action: "openTreasure" },
                    { id: "goToTemple", name: "è¿”å›ç¥åº™", action: "goToLocation", params: { location: "temple" } }
                ]
            }
        };
        
        // å½“å‰æ¸¸æˆæ•°æ®
        let gameData;
        // å½“å‰åœ°ç‚¹
        let currentLocation;
        // éŸ³ä¹çŠ¶æ€
        let musicPlaying = true;
        // èƒŒæ™¯éŸ³ä¹å…ƒç´ 
        const locationMusic = document.getElementById('locationMusic');
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // è·å–URLå‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const loc = urlParams.get('loc') || 'library';
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame(loc);
            
            // æ’­æ”¾éŸ³ä¹
            playMusic();
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame(location) {
            // è·å–ä¿å­˜çš„æ¸¸æˆæ•°æ®
            gameData = getGameData();
            // æ›´æ–°å½“å‰ä½ç½®
            gameData.currentLocation = location;
            currentLocation = location;
            
            // æ›´æ–°UI
            updateUI();
            // ç”ŸæˆæŒ‰é’®
            generateButtons();
            // è®°å½•æ—¥å¿—
            log(`åˆ°è¾¾${LOCATIONS[location].name}`);
        }
        
        // æ›´æ–°UI
        function updateUI() {
            const location = LOCATIONS[currentLocation];
            
            // è®¾ç½®åœºæ™¯èƒŒæ™¯
            document.getElementById('sceneContainer').className = `scene-container scene-${currentLocation}`;
            
            // æ›´æ–°åœºæ™¯ä¿¡æ¯
            document.getElementById('locationTitle').textContent = location.name;
            document.getElementById('locationDescription').textContent = location.description;
            document.getElementById('currentLocation').textContent = location.name;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            document.getElementById('gold').textContent = gameData.gold;
            document.getElementById('helpers').textContent = gameData.helpers;
            document.getElementById('clues').textContent = gameData.clues;
        }
        
        // ç”ŸæˆæŒ‰é’®
        function generateButtons() {
            const buttonsContainer = document.getElementById('actionButtons');
            buttonsContainer.innerHTML = '';
            
            const actions = LOCATIONS[currentLocation].actions;
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.textContent = action.name;
                
                // æ£€æŸ¥æ¡ä»¶
                let disabled = false;
                if (action.condition) {
                    disabled = !action.condition(gameData);
                }
                button.disabled = disabled;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                button.addEventListener('click', () => {
                    executeAction(action);
                });
                
                buttonsContainer.appendChild(button);
            });
        }
        
        // æ‰§è¡ŒåŠ¨ä½œ
        async function executeAction(action) {
            switch (action.action) {
                case 'searchClue':
                    await searchClue();
                    break;
                case 'decodeClue':
                    await decodeClue();
                    break;
                case 'hireHelper':
                    await hireHelper();
                    break;
                case 'crossForest':
                    await crossForest();
                    break;
                case 'searchTemple':
                    await searchTemple();
                    break;
                case 'openTreasure':
                    await openTreasure();
                    break;
                case 'goToLocation':
                    goToLocation(action.params.location);
                    break;
            }
        }
        
        // æœç´¢çº¿ç´¢
        async function searchClue() {
            if (gameData.clues >= 1) {
                log('å·²ç»æ‰¾åˆ°äº†è¶³å¤Ÿçš„çº¿ç´¢ï¼', 'warning');
                return;
            }
            
            log('å¼€å§‹åœ¨å›¾ä¹¦é¦†ä¸­æœç´¢çº¿ç´¢...');
            await delay(1000);
            
            log('æ‰¾åˆ°äº†ä¸€æ¡å¤è€çš„çº¿ç´¢ï¼', 'success');
            gameData.clues += 1;
            gameData.gold += GAME_CONFIG.clueReward;
            log(`è·å¾—äº†${GAME_CONFIG.clueReward}é‡‘å¸å’Œ1æ¡çº¿ç´¢ï¼`, 'success');
            
            updateGameData();
        }
        
        // è§£ç çº¿ç´¢
        async function decodeClue() {
            log('å°è¯•è§£ç å¤ä»£æ–‡å­—...');
            await delay(1500);
            
            log('è§£ç æˆåŠŸï¼å‘ç°äº†å®è—çš„çº¿ç´¢ï¼', 'success');
            log('çº¿ç´¢æŒ‡å‘äº†å†’é™©è€…å·¥ä¼šï¼Œä½ éœ€è¦å»é‚£é‡Œé›‡ä½£æ‰“æ‰‹ï¼', 'success');
            
            // è§£é”å·¥ä¼šåœºæ™¯
            if (!gameData.unlockedScenes.includes('guild')) {
                gameData.unlockedScenes.push('guild');
                log('ğŸ‰ è§£é”äº†æ–°åœºæ™¯ï¼šå†’é™©è€…å·¥ä¼šï¼', 'success');
            }
            
            // æ ‡è®°å›¾ä¹¦é¦†åœºæ™¯å®Œæˆ
            if (!gameData.completedScenes.includes('library')) {
                gameData.completedScenes.push('library');
            }
            
            updateGameData();
        }
        
        // é›‡ä½£æ‰“æ‰‹
        async function hireHelper() {
            if (gameData.gold < GAME_CONFIG.helperCost) {
                log('é‡‘å¸ä¸è¶³ï¼Œæ— æ³•é›‡ä½£æ‰“æ‰‹ï¼', 'error');
                return;
            }
            
            log('åœ¨å·¥ä¼šä¸­å¯»æ‰¾åˆé€‚çš„æ‰“æ‰‹...');
            await delay(1000);
            
            const success = Math.random() < 0.5;
            if (success) {
                gameData.gold -= GAME_CONFIG.helperCost;
                gameData.helpers += 1;
                log('æˆåŠŸé›‡ä½£äº†ä¸€åæ‰“æ‰‹ï¼', 'success');
                
                // å½“é›‡ä½£è‡³å°‘1åæ‰“æ‰‹æ—¶ï¼Œè§£é”æ£®æ—åœºæ™¯
                if (gameData.helpers >= 1 && !gameData.unlockedScenes.includes('forest')) {
                    gameData.unlockedScenes.push('forest');
                    log('ğŸ‰ è§£é”äº†æ–°åœºæ™¯ï¼šç¥ç§˜æ£®æ—ï¼', 'success');
                    log('ä½ ç°åœ¨å¯ä»¥å‰å¾€ç¥ç§˜æ£®æ—å†’é™©äº†ï¼', 'success');
                }
            } else {
                log('é›‡ä½£å¤±è´¥ï¼Œå€™é€‰äººæ‹’ç»äº†ä½ çš„é‚€è¯·...', 'error');
            }
            
            updateGameData();
        }
        
        // ç©¿è¶Šæ£®æ—
        async function crossForest() {
            log('å¼€å§‹ç©¿è¶Šç¥ç§˜æ£®æ—...');
            await delay(2000);
            
            const success = Math.random() > 0.25;
            if (success) {
                log('æˆåŠŸç©¿è¶Šæ£®æ—ï¼', 'success');
                
                // åœ¨æ£®æ—ä¸­å¯ä»¥æ‰¾åˆ°ç¬¬äºŒä¸ªçº¿ç´¢
                if (gameData.clues < 2) {
                    log('åœ¨æ£®æ—ä¸­å‘ç°äº†å¦ä¸€æ¡çº¿ç´¢ï¼', 'success');
                    gameData.clues += 1;
                    log('è¿™æ¡çº¿ç´¢æŒ‡å‘äº†ç¥åœ£ç¥åº™ï¼Œé‚£é‡Œå¯èƒ½æœ‰å®è—çš„ä½ç½®ï¼', 'success');
                }
                
                // è§£é”ç¥åº™åœºæ™¯
                if (!gameData.unlockedScenes.includes('temple')) {
                    gameData.unlockedScenes.push('temple');
                    log('ğŸ‰ è§£é”äº†æ–°åœºæ™¯ï¼šç¥åœ£ç¥åº™ï¼', 'success');
                }
            } else {
                log('åœ¨æ£®æ—ä¸­è¿·å¤±äº†æ–¹å‘ï¼Œè€½è¯¯äº†æ—¶é—´...', 'warning');
                // æœ‰æ¦‚ç‡æŸå¤±é‡‘å¸
                const goldLoss = Math.floor(Math.random() * 20) + 10;
                gameData.gold = Math.max(0, gameData.gold - goldLoss);
                log(`åœ¨æ£®æ—ä¸­é‡åˆ°äº†å°å·ï¼ŒæŸå¤±äº†${goldLoss}é‡‘å¸ï¼`, 'error');
            }
            
            updateGameData();
        }
        
        // æœç´¢ç¥åº™
        async function searchTemple() {
            log('åœ¨ç¥åº™ä¸­æœç´¢å®è—...');
            await delay(1500);
            
            // è§¦å‘å®ˆå«æˆ˜æ–—
            log('ç¥åº™å®ˆå«å‡ºç°äº†ï¼', 'warning');
            log('å®ˆå«çœ‹èµ·æ¥éå¸¸å¼ºå¤§ï¼Œä½ å¿…é¡»ä¸ä»–ä»¬æˆ˜æ–—ï¼', 'warning');
            await delay(1000);
            
            if (gameData.helpers > 0) {
                // æœ‰æ‰“æ‰‹ï¼šè®¡ç®—æˆ˜æ–—ç»“æœ
                const battleSuccess = Math.random() > 0.3;
                if (battleSuccess) {
                    // èƒœåˆ©
                    const lostHelpers = Math.floor(Math.random() * 2) + 1;
                    const actualLost = Math.min(lostHelpers, gameData.helpers);
                    gameData.helpers -= actualLost;
                    gameData.lostHelpers += actualLost;
                    
                    log(`ä¸å®ˆå«æˆ˜æ–—ï¼ŒæŸå¤±äº†${actualLost}åæ‰“æ‰‹ï¼Œä½†æˆåŠŸå‡»é€€äº†å®ˆå«ï¼`, 'success');
                    log('åœ¨ç¥åº™ä¸­å‘ç°äº†å®è—çš„ä½ç½®ï¼', 'success');
                    
                    // è§£é”å®è—åœºæ™¯
                    if (!gameData.unlockedScenes.includes('treasure')) {
                        gameData.unlockedScenes.push('treasure');
                        log('ğŸ‰ è§£é”äº†æ–°åœºæ™¯ï¼šå®è—åœ°ç‚¹ï¼', 'success');
                    }
                } else {
                    // å¤±è´¥
                    log('æˆ˜æ–—å¤±è´¥ï¼æ‰€æœ‰æ‰“æ‰‹éƒ½è¢«å‡»è´¥äº†ï¼', 'error');
                    gameData.helpers = 0;
                    gameData.lostHelpers = 0;
                    gameData.gold = Math.floor(gameData.gold * 0.5);
                    log('ä½ è¢«å®ˆå«å‡»è´¥ï¼Œå¤±å»äº†æ‰€æœ‰æ‰“æ‰‹å’Œä¸€åŠé‡‘å¸ï¼', 'error');
                }
            } else {
                // æ²¡æœ‰æ‰“æ‰‹ï¼šç›´æ¥å¤±è´¥
                log('æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œä½ è¢«å®ˆå«è½»æ¾æŠ“ä½äº†ï¼', 'error');
                gameOver('å¤±è´¥', 'æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œè¢«å®ˆå«æŠ“ä½');
                return;
            }
            
            updateGameData();
        }
        
        // æ¸¸æˆç»“æŸå‡½æ•°
        function gameOver(result, reason) {
            gameData.gameOver = true;
            gameData.gameResult = result;
            gameData.status = result === 'èƒœåˆ©' ? 'æ¸¸æˆèƒœåˆ©' : 'æ¸¸æˆå¤±è´¥';
            
            log(`${result}ï¼${reason}`, result === 'èƒœåˆ©' ? 'success' : 'error');
            log('æ¸¸æˆå·²ç»“æŸï¼Œç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®å¼€å§‹æ–°æ¸¸æˆï¼', 'info');
            
            // æ·»åŠ é‡æ–°å¼€å§‹æŒ‰é’®
            const restartBtn = document.createElement('button');
            restartBtn.textContent = 'é‡æ–°å¼€å§‹æ¸¸æˆ';
            restartBtn.className = 'secondary';
            restartBtn.onclick = () => {
                resetGameData();
                window.location.reload();
            };
            
            const actionButtons = document.getElementById('actionButtons');
            actionButtons.innerHTML = '';
            actionButtons.appendChild(restartBtn);
            
            updateGameData();
        }
        
        // æ‰“å¼€å®è—
        async function openTreasure() {
            log('å°è¯•æ‰“å¼€ç¥ç§˜å®ç®±...');
            await delay(2000);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ‰“æ‰‹ä¿æŠ¤
            if (gameData.helpers < 1) {
                log('æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œå®ç®±çš„æœºå…³è¢«è§¦å‘äº†ï¼', 'error');
                gameOver('å¤±è´¥', 'æ²¡æœ‰æ‰“æ‰‹ä¿æŠ¤ï¼Œè§¦å‘äº†å®ç®±çš„æœºå…³');
                return;
            }
            
            log('æ­å–œï¼ä½ æ‰¾åˆ°äº†ä¼ è¯´ä¸­çš„å®è—ï¼', 'success');
            log(`è·å¾—äº†${GAME_CONFIG.treasureReward}é‡‘å¸ï¼`, 'success');
            
            gameData.gold += GAME_CONFIG.treasureReward;
            
            // æ”¯ä»˜æ‰“æ‰‹æŠ¥é…¬
            const payment = gameData.helpers * GAME_CONFIG.helperReward;
            gameData.gold -= payment;
            log(`æ”¯ä»˜${payment}é‡‘å¸ç»™${gameData.helpers}åæ‰“æ‰‹ä½œä¸ºæŠ¥é…¬`, 'info');
            
            // æ¸¸æˆèƒœåˆ©
            gameOver('èƒœåˆ©', `æˆåŠŸæ‰¾åˆ°å®è—ï¼Œè·å¾—äº†${GAME_CONFIG.treasureReward}é‡‘å¸`);
            
            updateGameData();
        }
        
        // å‰å¾€å…¶ä»–åœ°ç‚¹
        function goToLocation(location) {
            log(`å‰å¾€${LOCATIONS[location].name}`);
            // æ›´æ–°å½“å‰ä½ç½®å¹¶ä¿å­˜å®Œæ•´æ¸¸æˆæ•°æ®
            gameData.currentLocation = location;
            saveGameData(gameData);
            window.location.href = `location.html?loc=${location}`;
        }
        
        // è¿”å›å…¨æ™¯å›¾
        function goBackToPanorama() {
            // ä¿å­˜å®Œæ•´æ¸¸æˆæ•°æ®
            saveGameData(gameData);
            window.location.href = 'panorama.html';
        }
        
        // æ›´æ–°æ¸¸æˆæ•°æ®
        function updateGameData() {
            updateUI();
            generateButtons();
            saveGameData(gameData);
        }
        
        // ä¿å­˜æ¸¸æˆæ•°æ®
        function saveGameData(data) {
            localStorage.setItem('treasureHuntGame', JSON.stringify(data));
        }
        
        // è·å–æ¸¸æˆæ•°æ®
        function getGameData() {
            const savedData = localStorage.getItem('treasureHuntGame');
            return savedData ? JSON.parse(savedData) : {
                gold: GAME_CONFIG.initialGold,
                helpers: 0,
                lostHelpers: 0,
                clues: 0,
                unlockedScenes: ['library'], // åˆå§‹åªè§£é”å›¾ä¹¦é¦†
                completedScenes: [],
                currentLocation: 'library',
                phase: 'æœªå¼€å§‹',
                status: 'å°±ç»ª',
                gameOver: false,
                gameResult: null
            };
        }
        
        // é‡ç½®æ¸¸æˆæ•°æ®
        function resetGameData() {
            localStorage.setItem('treasureHuntGame', JSON.stringify({
                gold: GAME_CONFIG.initialGold,
                helpers: 0,
                lostHelpers: 0,
                clues: 0,
                unlockedScenes: ['library'],
                completedScenes: [],
                currentLocation: 'library',
                phase: 'æœªå¼€å§‹',
                status: 'å°±ç»ª',
                gameOver: false,
                gameResult: null
            }));
        }
        
        // æ—¥å¿—è®°å½•
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            if (logContainer.children.length > 10) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        // å»¶è¿Ÿå‡½æ•°
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // è¿”å›ä¸»æ¸¸æˆç•Œé¢
        function goToMainGame() {
            // ä¿å­˜å½“å‰æ¸¸æˆæ•°æ®
            saveGameData(gameData);
            window.location.href = 'index.html';
        }
        
        // éŸ³ä¹æ§åˆ¶
        function playMusic() {
            // è®¾ç½®å½“å‰åœ°ç‚¹çš„éŸ³ä¹
            const musicSource = document.getElementById('musicSource');
            musicSource.src = LOCATIONS[currentLocation].musicUrl;
            locationMusic.load();
            
            locationMusic.play().catch(err => {
                console.log('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³ä¹');
            });
            musicPlaying = true;
            document.getElementById('musicIcon').textContent = 'ğŸ”Š';
        }
        
        function pauseMusic() {
            locationMusic.pause();
            musicPlaying = false;
            document.getElementById('musicIcon').textContent = 'ğŸ”‡';
        }
        
        function toggleMusic() {
            if (musicPlaying) {
                pauseMusic();
            } else {
                playMusic();
            }
        }
    </script>
</body>
</html>