<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒäººé…’é¦† - å¯»å®å¤§å†’é™©</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="scene-page tavern">
    <div class="container">
        <div class="scene-header">
            <h1>ğŸº çŒäººé…’é¦†</h1>
            <button class="back-btn" onclick="window.location.href='index.html'">è¿”å›åœ°å›¾</button>
        </div>
        
        <div class="status-panel">
            <p>é‡‘å¸: <span id="gold">50</span> | æ‰“æ‰‹: <span id="helpers">0</span>äºº | çº¿ç´¢: <span id="clue">æœªæ‰¾åˆ°</span></p>
            <button class="music-toggle" onclick="toggleMusic()">ğŸµ éŸ³ä¹ï¼šå¼€å¯</button>
        </div>
        
        <div class="scene-content">
            <p class="description">é…’é¦†é‡Œäººå£°é¼æ²¸ï¼Œå†’é™©è€…ä»¬æ­£åœ¨å–é…’èŠå¤©ï¼Œä½ å¯ä»¥é›‡ä½£ä»–ä»¬å¸®ä½ æ¢ç´¢ç¥åº™...</p>
            
            <div class="actions">
                <button onclick="hireHelper()">é›‡ä½£æ‰“æ‰‹ï¼ˆ10é‡‘å¸/äººï¼‰</button>
                <button onclick="buyInfo()">è´­ä¹°æƒ…æŠ¥ï¼ˆ5é‡‘å¸ï¼‰</button>
            </div>
            
            <div class="log-container">
                <h3>é…’é¦†æ—¥å¿—</h3>
                <div class="log" id="log"></div>
            </div>
        </div>
    </div>

    <!-- é…’é¦†èƒŒæ™¯éŸ³ä¹ï¼ˆçƒ­é—¹ä¼‘é—²é£æ ¼ï¼‰ -->
    <audio id="bg-music" loop>
        <source src="https://mixkit.co/music/preview/mixkit-medieval-tavern-background-music-637.mp3" type="audio/mpeg">
    

    <script src="js/game.js"></script>
    <script>
        const gameState = loadGameState();
        updateUI();
        
        // æ£€æŸ¥è§£é”çŠ¶æ€
        if (!gameState.sceneCompleted.library) {
            addLog('è€æ¿ï¼š"æ²¡çº¿ç´¢ï¼Ÿå…ˆå»å›¾ä¹¦é¦†æ‰¾è—å®å›¾å†æ¥ï¼"', 'error');
            document.querySelector('button[onclick="hireHelper()"]').disabled = true;
            document.querySelector('button[onclick="buyInfo()"]').disabled = true;
        } else {
            addLog('ä½ èµ°è¿›é…’é¦†ï¼Œå†’é™©è€…ä»¬æŠ•æ¥å¥½å¥‡çš„ç›®å…‰...', 'info');
        }

        // éŸ³ä¹åˆå§‹åŒ–
        const music = document.getElementById('bg-music');
        music.volume = 0.2;
        updateMusicButton();

        // é¦–æ¬¡ç‚¹å‡»æ’­æ”¾éŸ³ä¹
        document.body.addEventListener('click', playMusicOnFirstClick, { once: true });

        // éŸ³ä¹æ§åˆ¶å‡½æ•°
        function playMusicOnFirstClick() {
            if (gameState.musicEnabled && music.paused) {
                music.play().catch(e => console.log('éŸ³ä¹éœ€ç‚¹å‡»åæ’­æ”¾'));
            }
        }

        function toggleMusic() {
            gameState.musicEnabled = !gameState.musicEnabled;
            if (gameState.musicEnabled) {
                music.play();
            } else {
                music.pause();
            }
            updateMusicButton();
            saveGameState();
        }

        function updateMusicButton() {
            const btn = document.querySelector('.music-toggle');
            btn.textContent = gameState.musicEnabled ? 'ğŸµ éŸ³ä¹ï¼šå¼€å¯' : 'ğŸµ éŸ³ä¹ï¼šå…³é—­';
        }

        // åŸæœ‰æ¸¸æˆé€»è¾‘
        async function hireHelper() {
            if (gameState.gold < 10) {
                addLog('é‡‘å¸ä¸è¶³ï¼é›‡ä½£1äººéœ€è¦10é‡‘å¸', 'error');
                return;
            }
            if (gameState.sceneCompleted.tavern) {
                addLog('å·²é›‡ä½£è¶³å¤Ÿæ‰“æ‰‹ï¼Œå»ç¥åº™å§ï¼', 'info');
                return;
            }
            
            addLog('ä¸å¼ºå£®çš„å†’é™©è€…äº¤è°ˆï¼Œè¯•å›¾é›‡ä½£ä»–...', 'info');
            await delay(1500);
            
            if (Math.random() < 0.8) {
                gameState.gold -= 10;
                gameState.helpers += 1;
                addLog(`æˆåŠŸé›‡ä½£1åæ‰“æ‰‹ï¼å‰©ä½™é‡‘å¸ï¼š${gameState.gold}ï¼Œå½“å‰å…±${gameState.helpers}äºº`, 'success');
                
                if (gameState.helpers >= 3) {
                    gameState.sceneCompleted.tavern = true;
                    gameState.scenes.temple = true;
                    addLog('ğŸ”“ ç¥ç§˜ç¥åº™å·²è§£é”ï¼', 'success');
                }
            } else {
                addLog('å¯¹æ–¹æ‹’ç»äº†ä½ çš„é›‡ä½£...', 'warning');
            }
            saveGameState();
            updateUI();
        }
        
        async function buyInfo() {
            if (gameState.gold < 5) {
                addLog('é‡‘å¸ä¸è¶³ï¼æƒ…æŠ¥éœ€è¦5é‡‘å¸', 'error');
                return;
            }
            
            gameState.gold -= 5;
            addLog('èŠ±è´¹5é‡‘å¸å‘è€æ¿è´­ä¹°æƒ…æŠ¥...', 'info');
            await delay(1000);
            
            const tips = [
                'è€æ¿ï¼š"ç¥åº™å®ˆå«å¾ˆå‡¶ï¼Œè‡³å°‘3äººæ‰èƒ½å¯¹ä»˜"',
                'è€æ¿ï¼š"å®è—å¾ˆé‡ï¼Œéœ€è¦æ‰“æ‰‹å¸®å¿™æ¬è¿"',
                'è€æ¿ï¼š"å‡ºå£ç»“ç®—æ—¶ï¼Œæ¯ä¸ªæ‰“æ‰‹è¦8é‡‘å¸å°¾æ¬¾"',
                'è€æ¿ï¼š"ç¥åº™é‡Œæœ‰é™·é˜±ï¼Œå°å¿ƒï¼"'
            ];
            addLog(tips[Math.floor(Math.random() * tips.length)], 'info');
            
            saveGameState();
            updateUI();
        }
    </script>
</body>
</html>
