<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤è€å›¾ä¹¦é¦† - å¯»å®å¤§å†’é™©</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="scene-page library">
    <div class="container">
        <div class="scene-header">
            <h1>ğŸ“š å¤è€å›¾ä¹¦é¦†</h1>
            <button class="back-btn" onclick="window.location.href='index.html'">è¿”å›åœ°å›¾</button>
        </div>
        
        <div class="status-panel">
            <p>é‡‘å¸: <span id="gold">50</span> | æ‰“æ‰‹: <span id="helpers">0</span>äºº | çº¿ç´¢: <span id="clue">æœªæ‰¾åˆ°</span></p>
            <button class="music-toggle" onclick="toggleMusic()">ğŸµ éŸ³ä¹ï¼šå¼€å¯</button>
        </div>
        
        <div class="scene-content">
            <p class="description">è¿™é‡Œå †æ»¡äº†å°˜å°çš„å¤ç±ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€çº¸å¼ å’Œå¢¨æ°´çš„å‘³é“ï¼Œä¹Ÿè®¸è—ç€å®è—çš„çº¿ç´¢...</p>
            
            <div class="actions">
                <button onclick="searchBooks()">æœç´¢å¤ç±ï¼ˆæ‰¾çº¿ç´¢ï¼‰</button>
                <button onclick="checkDesk()">æ£€æŸ¥ä¹¦æ¡Œï¼ˆæ‰¾é‡‘å¸ï¼‰</button>
            </div>
            
            <div class="log-container">
                <h3>å†’é™©æ—¥å¿—</h3>
                <div class="log" id="log"></div>
            </div>
        </div>
    </div>

    <!-- å›¾ä¹¦é¦†èƒŒæ™¯éŸ³ä¹ï¼ˆç¥ç§˜è§£è°œé£æ ¼ï¼‰ -->
    <audio id="bg-music" loop>
        <source src="https://mixkit.co/music/preview/mixkit-mystery-game-suspense-689.mp3" type="audio/mpeg">
    </audio>

    <script src="js/game.js"></script>
    <script>
        const gameState = loadGameState();
        updateUI();
        addLog('ä½ èµ°è¿›äº†å¤è€å›¾ä¹¦é¦†ï¼Œä¹¦æ¶ä¸Šæ‘†æ»¡äº†åƒå¹´å¤ç±...');

        // éŸ³ä¹åˆå§‹åŒ–
        const music = document.getElementById('bg-music');
        music.volume = 0.2;
        updateMusicButton();

        // é¦–æ¬¡ç‚¹å‡»æ’­æ”¾éŸ³ä¹
        document.body.addEventListener('click', playMusicOnFirstClick, { once: true });

        // éŸ³ä¹æ§åˆ¶å‡½æ•°
        function playMusicOnFirstClick() {
            if (gameState.musicEnabled && music.paused) {
                music.play().catch(e => console.log('éŸ³ä¹éœ€ç‚¹å‡»åæ’­æ”¾'));
            }
        }

        function toggleMusic() {
            gameState.musicEnabled = !gameState.musicEnabled;
            if (gameState.musicEnabled) {
                music.play();
            } else {
                music.pause();
            }
            updateMusicButton();
            saveGameState();
        }

        function updateMusicButton() {
            const btn = document.querySelector('.music-toggle');
            btn.textContent = gameState.musicEnabled ? 'ğŸµ éŸ³ä¹ï¼šå¼€å¯' : 'ğŸµ éŸ³ä¹ï¼šå…³é—­';
        }

        // åŸæœ‰æ¸¸æˆé€»è¾‘
        async function searchBooks() {
            if (gameState.sceneCompleted.library) {
                addLog('ä½ å·²ç»æ‰¾åˆ°çº¿ç´¢äº†ï¼Œå»é…’é¦†å§ï¼', 'info');
                return;
            }
            
            addLog('å¼€å§‹ç¿»é˜…å¤ç±ï¼Œå¯»æ‰¾è—å®å›¾...', 'info');
            await delay(2000);
            
            if (Math.random() < 0.7) {
                gameState.hasClue = true;
                gameState.sceneCompleted.library = true;
                gameState.scenes.tavern = true;
                addLog('ğŸ‰ æ‰¾åˆ°è—å®å›¾ï¼ä¸Šé¢æ ‡è®°ç€ç¥åº™çš„ä½ç½®', 'success');
                addLog('ğŸ”“ çŒäººé…’é¦†å·²è§£é”', 'success');
            } else {
                addLog('è¿™æœ¬å¤ç±é‡Œåªæœ‰ä¸€äº›ç¥è¯æ•…äº‹...', 'warning');
            }
            saveGameState();
            updateUI();
        }
        
        async function checkDesk() {
            addLog('æ£€æŸ¥å­¦è€…çš„ä¹¦æ¡Œ...', 'info');
            await delay(1500);
            
            const goldFound = Math.floor(Math.random() * 15) + 5;
            gameState.gold += goldFound;
            addLog(`æ‰¾åˆ° ${goldFound} æšé‡‘å¸ï¼å½“å‰é‡‘å¸ï¼š${gameState.gold}`, 'success');
            
            saveGameState();
            updateUI();
        }
    </script>
</body>
</html>
